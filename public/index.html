<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atomic Education - ERP Tizimi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#eff6ff',
                500: '#3b82f6',
                600: '#2563eb',
                700: '#1d4ed8',
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50" x-data="app()" x-init="init()">
    <!-- Loading Screen -->
    <div
      x-show="loading"
      class="fixed inset-0 bg-white z-50 flex items-center justify-center"
    >
      <div class="text-center">
        <div
          class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto"
        ></div>
        <p class="mt-4 text-gray-600">Yuklanmoqda...</p>
      </div>
    </div>

    <!-- Notification Toast -->
    <div
      x-show="notification.show"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 transform translate-y-2"
      x-transition:enter-end="opacity-100 transform translate-y-0"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100 transform translate-y-0"
      x-transition:leave-end="opacity-0 transform translate-y-2"
      class="fixed top-4 right-4 z-50 max-w-sm w-full"
    >
      <div
        class="bg-white rounded-lg shadow-lg border-l-4 p-4"
        :class="{
                'border-green-500': notification.type === 'success',
                'border-red-500': notification.type === 'error',
                'border-yellow-500': notification.type === 'warning',
                'border-blue-500': notification.type === 'info'
             }"
      >
        <div class="flex">
          <div class="flex-shrink-0">
            <i
              class="text-lg"
              :class="{
                        'fas fa-check-circle text-green-500': notification.type === 'success',
                        'fas fa-exclamation-circle text-red-500': notification.type === 'error',
                        'fas fa-exclamation-triangle text-yellow-500': notification.type === 'warning',
                        'fas fa-info-circle text-blue-500': notification.type === 'info'
                       }"
            ></i>
          </div>
          <div class="ml-3 flex-1">
            <p
              class="text-sm font-medium text-gray-900"
              x-text="notification.title"
            ></p>
            <p class="text-sm text-gray-500" x-text="notification.message"></p>
          </div>
          <div class="ml-4 flex-shrink-0">
            <button
              @click="hideNotification()"
              class="text-gray-400 hover:text-gray-600"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Login Page -->
    <div
      x-show="!isAuthenticated"
      class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
    >
      <div class="max-w-md w-full space-y-8">
        <div class="text-center">
          <h2 class="mt-6 text-3xl font-extrabold text-gray-900">
            Atomic Education
          </h2>
          <p class="mt-2 text-sm text-gray-600">ERP tizimiga kirish</p>
        </div>
        <form @submit.prevent="login()" class="mt-8 space-y-6">
          <div class="space-y-4">
            <div>
              <label
                for="phone"
                class="block text-sm font-medium text-gray-700"
              >
                Telefon raqami
              </label>
              <input
                x-model="loginForm.phone"
                type="tel"
                id="phone"
                required
                placeholder="+998901234567"
                class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
              />
            </div>
            <div>
              <label
                for="password"
                class="block text-sm font-medium text-gray-700"
              >
                Parol
              </label>
              <input
                x-model="loginForm.password"
                type="password"
                id="password"
                required
                class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
              />
            </div>
          </div>

          <div>
            <button
              type="submit"
              :disabled="loginLoading"
              class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span x-show="!loginLoading">Kirish</span>
              <span x-show="loginLoading" class="flex items-center">
                <div
                  class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"
                ></div>
                Kirish...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Main App -->
    <div x-show="isAuthenticated" class="min-h-screen bg-gray-50">
      <!-- Navigation -->
      <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-16">
            <div class="flex items-center">
              <h1 class="text-xl font-semibold text-gray-900">
                Atomic Education
              </h1>
            </div>
            <div class="flex items-center space-x-4">
              <span
                class="text-sm text-gray-700"
                x-text="user?.fullName"
              ></span>
              <div class="relative" x-data="{ open: false }">
                <button
                  @click="open = !open"
                  class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                >
                  <div
                    class="h-8 w-8 rounded-full bg-primary-500 flex items-center justify-center text-white text-sm font-medium"
                  >
                    <span x-text="user?.fullName?.charAt(0)"></span>
                  </div>
                </button>
                <div
                  x-show="open"
                  @click.away="open = false"
                  x-transition:enter="transition ease-out duration-100"
                  x-transition:enter-start="transform opacity-0 scale-95"
                  x-transition:enter-end="transform opacity-100 scale-100"
                  x-transition:leave="transition ease-in duration-75"
                  x-transition:leave-start="transform opacity-100 scale-100"
                  x-transition:leave-end="transform opacity-0 scale-95"
                  class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5"
                >
                  <div class="py-1">
                    <a
                      href="#"
                      class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                      >Profil</a
                    >
                    <a
                      href="#"
                      class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                      >Sozlamalar</a
                    >
                    <button
                      @click="logout()"
                      class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    >
                      Chiqish
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- Sidebar and Main Content -->
      <div class="flex">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-sm min-h-screen">
          <nav class="mt-5 px-2">
            <div class="space-y-1">
              <button
                @click="currentPage = 'dashboard'"
                :class="currentPage === 'dashboard' ? 'bg-primary-100 text-primary-700' : 'text-gray-600 hover:bg-gray-50'"
                class="group flex items-center px-2 py-2 text-sm font-medium rounded-md w-full"
              >
                <i class="fas fa-tachometer-alt mr-3"></i>
                Dashboard
              </button>
              <button
                @click="currentPage = 'students'"
                :class="currentPage === 'students' ? 'bg-primary-100 text-primary-700' : 'text-gray-600 hover:bg-gray-50'"
                class="group flex items-center px-2 py-2 text-sm font-medium rounded-md w-full"
              >
                <i class="fas fa-user-graduate mr-3"></i>
                O'quvchilar
              </button>
              <button
                @click="currentPage = 'groups'"
                :class="currentPage === 'groups' ? 'bg-primary-100 text-primary-700' : 'text-gray-600 hover:bg-gray-50'"
                class="group flex items-center px-2 py-2 text-sm font-medium rounded-md w-full"
              >
                <i class="fas fa-users mr-3"></i>
                Guruhlar
              </button>
              <button
                @click="currentPage = 'badges'"
                :class="currentPage === 'badges' ? 'bg-primary-100 text-primary-700' : 'text-gray-600 hover:bg-gray-50'"
                class="group flex items-center px-2 py-2 text-sm font-medium rounded-md w-full"
              >
                <i class="fas fa-medal mr-3"></i>
                Badge'lar
              </button>
              <button
                @click="currentPage = 'payments'"
                :class="currentPage === 'payments' ? 'bg-primary-100 text-primary-700' : 'text-gray-600 hover:bg-gray-50'"
                class="group flex items-center px-2 py-2 text-sm font-medium rounded-md w-full"
              >
                <i class="fas fa-credit-card mr-3"></i>
                To'lovlar
              </button>
              <button
                @click="currentPage = 'daily-badges'"
                :class="currentPage === 'daily-badges' ? 'bg-primary-100 text-primary-700' : 'text-gray-600 hover:bg-gray-50'"
                class="group flex items-center px-2 py-2 text-sm font-medium rounded-md w-full"
              >
                <i class="fas fa-calendar-day mr-3"></i>
                Kunlik Badge'lar
              </button>
            </div>
          </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
          <!-- Dashboard -->
          <div x-show="currentPage === 'dashboard'">
            <div class="mb-6">
              <h2 class="text-2xl font-bold text-gray-900">Dashboard</h2>
              <p class="text-gray-600">Tizim umumiy ko'rinishi</p>
            </div>

            <!-- Stats Cards -->
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
            >
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i
                        class="fas fa-user-graduate text-2xl text-blue-500"
                      ></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">
                          Jami O'quvchilar
                        </dt>
                        <dd
                          class="text-lg font-medium text-gray-900"
                          x-text="stats.students?.total || 0"
                        ></dd>
                      </dl>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i class="fas fa-users text-2xl text-green-500"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">
                          Guruhlar
                        </dt>
                        <dd
                          class="text-lg font-medium text-gray-900"
                          x-text="stats.groups || 0"
                        ></dd>
                      </dl>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i
                        class="fas fa-chalkboard-teacher text-2xl text-purple-500"
                      ></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">
                          O'qituvchilar
                        </dt>
                        <dd
                          class="text-lg font-medium text-gray-900"
                          x-text="stats.teachers || 0"
                        ></dd>
                      </dl>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <div class="flex items-center">
                    <div class="flex-shrink-0">
                      <i class="fas fa-medal text-2xl text-yellow-500"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                      <dl>
                        <dt class="text-sm font-medium text-gray-500 truncate">
                          Badge Foizi
                        </dt>
                        <dd
                          class="text-lg font-medium text-gray-900"
                          x-text="(stats.badges?.successRate || 0) + '%'"
                        ></dd>
                      </dl>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white shadow rounded-lg">
              <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                  So'nggi Faollik
                </h3>
                <div class="space-y-3">
                  <template
                    x-for="activity in stats.recentActivity"
                    :key="activity._id"
                  >
                    <div class="flex items-center space-x-3">
                      <div class="flex-shrink-0">
                        <div
                          class="h-8 w-8 rounded-full bg-primary-100 flex items-center justify-center"
                        >
                          <i class="fas fa-medal text-primary-600 text-sm"></i>
                        </div>
                      </div>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm text-gray-900">
                          <span
                            x-text="activity.student?.user?.fullName"
                          ></span>
                          - Badge yangilanishi
                        </p>
                        <p
                          class="text-sm text-gray-500"
                          x-text="new Date(activity.date).toLocaleDateString('uz-UZ')"
                        ></p>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <!-- Students Page -->
          <div x-show="currentPage === 'students'">
            <div class="mb-6 flex justify-between items-center">
              <div>
                <h2 class="text-2xl font-bold text-gray-900">O'quvchilar</h2>
                <p class="text-gray-600">O'quvchilarni boshqarish</p>
              </div>
              <button
                @click="showAddStudentModal = true"
                class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium"
              >
                <i class="fas fa-plus mr-2"></i>
                Yangi O'quvchi
              </button>
            </div>

            <!-- Filters -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Qidiruv</label
                  >
                  <input
                    x-model="studentFilters.search"
                    @input="loadStudents()"
                    type="text"
                    placeholder="Ism yoki telefon..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Guruh</label
                  >
                  <select
                    x-model="studentFilters.group"
                    @change="loadStudents()"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  >
                    <option value="">Barcha guruhlar</option>
                    <template x-for="group in groups" :key="group._id">
                      <option :value="group._id" x-text="group.name"></option>
                    </template>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Holat</label
                  >
                  <select
                    x-model="studentFilters.status"
                    @change="loadStudents()"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  >
                    <option value="">Barcha holatlar</option>
                    <option value="active">Faol</option>
                    <option value="inactive">Nofaol</option>
                    <option value="graduated">Bitirgan</option>
                    <option value="dropped">Tashlab ketgan</option>
                  </select>
                </div>
                <div class="flex items-end">
                  <button
                    @click="resetStudentFilters()"
                    class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm font-medium"
                  >
                    <i class="fas fa-undo mr-2"></i>
                    Tozalash
                  </button>
                </div>
              </div>
            </div>

            <!-- Students Table -->
            <div class="bg-white shadow rounded-lg overflow-hidden">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      O'quvchi
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Kod
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Guruh
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Telefon
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Holat
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Amallar
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <template x-for="student in students" :key="student._id">
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div class="h-10 w-10 flex-shrink-0">
                            <div
                              class="h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center"
                            >
                              <span
                                class="text-sm font-medium text-primary-700"
                                x-text="student.user?.fullName?.charAt(0)"
                              ></span>
                            </div>
                          </div>
                          <div class="ml-4">
                            <div
                              class="text-sm font-medium text-gray-900"
                              x-text="student.user?.fullName"
                            ></div>
                            <div
                              class="text-sm text-gray-500"
                              x-text="student.parent?.fullName"
                            ></div>
                          </div>
                        </div>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                        x-text="student.studentCode"
                      ></td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                        x-text="student.group?.name"
                      ></td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                        x-text="student.user?.phone"
                      ></td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                          :class="{
                                                    'bg-green-100 text-green-800': student.status === 'active',
                                                    'bg-red-100 text-red-800': student.status === 'inactive',
                                                    'bg-blue-100 text-blue-800': student.status === 'graduated',
                                                    'bg-gray-100 text-gray-800': student.status === 'dropped'
                                                  }"
                          x-text="getStatusText(student.status)"
                        >
                        </span>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm font-medium"
                      >
                        <button
                          @click="editStudent(student)"
                          class="text-primary-600 hover:text-primary-900 mr-3"
                        >
                          <i class="fas fa-edit"></i>
                        </button>
                        <button
                          @click="deleteStudent(student)"
                          class="text-red-600 hover:text-red-900"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>

              <!-- Pagination -->
              <div
                class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"
              >
                <div class="flex-1 flex justify-between sm:hidden">
                  <button
                    @click="prevStudentsPage()"
                    :disabled="!studentPagination.hasPrev"
                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Oldingi
                  </button>
                  <button
                    @click="nextStudentsPage()"
                    :disabled="!studentPagination.hasNext"
                    class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Keyingi
                  </button>
                </div>
                <div
                  class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"
                >
                  <div>
                    <p class="text-sm text-gray-700">
                      <span
                        x-text="((studentPagination.currentPage - 1) * 10) + 1"
                      ></span>
                      dan
                      <span
                        x-text="Math.min(studentPagination.currentPage * 10, studentPagination.total)"
                      ></span>
                      gacha, jami
                      <span x-text="studentPagination.total"></span>
                      ta natija
                    </p>
                  </div>
                  <div>
                    <nav
                      class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"
                    >
                      <button
                        @click="prevStudentsPage()"
                        :disabled="!studentPagination.hasPrev"
                        class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        <i class="fas fa-chevron-left"></i>
                      </button>
                      <span
                        class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"
                      >
                        <span x-text="studentPagination.currentPage"></span>
                        /
                        <span x-text="studentPagination.totalPages"></span>
                      </span>
                      <button
                        @click="nextStudentsPage()"
                        :disabled="!studentPagination.hasNext"
                        class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        <i class="fas fa-chevron-right"></i>
                      </button>
                    </nav>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Groups Page -->
          <div x-show="currentPage === 'groups'">
            <div class="mb-6 flex justify-between items-center">
              <div>
                <h2 class="text-2xl font-bold text-gray-900">Guruhlar</h2>
                <p class="text-gray-600">Guruhlarni boshqarish</p>
              </div>
              <button
                @click="showAddGroupModal = true"
                class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium"
              >
                <i class="fas fa-plus mr-2"></i>
                Yangi Guruh
              </button>
            </div>

            <!-- Groups Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <template x-for="group in groups" :key="group._id">
                <div class="bg-white overflow-hidden shadow rounded-lg">
                  <div class="p-5">
                    <div class="flex items-center">
                      <div class="flex-shrink-0">
                        <div
                          class="h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center"
                        >
                          <i class="fas fa-users text-primary-600"></i>
                        </div>
                      </div>
                      <div class="ml-5 w-0 flex-1">
                        <dl>
                          <dt
                            class="text-sm font-medium text-gray-500 truncate"
                          >
                            Guruh
                          </dt>
                          <dd
                            class="text-lg font-medium text-gray-900"
                            x-text="group.name"
                          ></dd>
                        </dl>
                      </div>
                    </div>
                    <div class="mt-4">
                      <div class="flex items-center text-sm text-gray-500">
                        <i class="fas fa-chalkboard-teacher mr-2"></i>
                        <span
                          x-text="group.teacher?.fullName || 'O\'qituvchi tayinlanmagan'"
                        ></span>
                      </div>
                      <div class="flex items-center text-sm text-gray-500 mt-1">
                        <i class="fas fa-user-graduate mr-2"></i>
                        <span x-text="group.studentCount || 0"></span> ta
                        o'quvchi
                      </div>
                      <div class="flex items-center text-sm text-gray-500 mt-1">
                        <i class="fas fa-calendar mr-2"></i>
                        <span x-text="group.schedule?.length || 0"></span>
                        kun/hafta
                      </div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                      <button
                        @click="editGroup(group)"
                        class="flex-1 bg-primary-100 text-primary-700 px-3 py-2 rounded-md text-sm font-medium hover:bg-primary-200"
                      >
                        <i class="fas fa-edit mr-1"></i>
                        Tahrirlash
                      </button>
                      <button
                        @click="deleteGroup(group)"
                        class="flex-1 bg-red-100 text-red-700 px-3 py-2 rounded-md text-sm font-medium hover:bg-red-200"
                      >
                        <i class="fas fa-trash mr-1"></i>
                        O'chirish
                      </button>
                    </div>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- Badges Page -->
          <div x-show="currentPage === 'badges'">
            <div class="mb-6 flex justify-between items-center">
              <div>
                <h2 class="text-2xl font-bold text-gray-900">Badge'lar</h2>
                <p class="text-gray-600">Badge'larni boshqarish</p>
              </div>
              <button
                @click="showAddBadgeModal = true"
                class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium"
              >
                <i class="fas fa-plus mr-2"></i>
                Yangi Badge
              </button>
            </div>

            <!-- Badges Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <template x-for="badge in badges" :key="badge._id">
                <div class="bg-white overflow-hidden shadow rounded-lg">
                  <div class="p-5">
                    <div class="flex items-center">
                      <div class="flex-shrink-0">
                        <div
                          class="h-10 w-10 rounded-full flex items-center justify-center text-2xl"
                          :class="{
                                                    'bg-green-100': badge.color === 'green',
                                                    'bg-blue-100': badge.color === 'blue',
                                                    'bg-yellow-100': badge.color === 'yellow',
                                                    'bg-purple-100': badge.color === 'purple',
                                                    'bg-orange-100': badge.color === 'orange',
                                                    'bg-red-100': badge.color === 'red'
                                                 }"
                        >
                          <span x-text="badge.emoji"></span>
                        </div>
                      </div>
                      <div class="ml-5 w-0 flex-1">
                        <dl>
                          <dt
                            class="text-sm font-medium text-gray-500 truncate"
                          >
                            Badge
                          </dt>
                          <dd
                            class="text-lg font-medium text-gray-900"
                            x-text="badge.name"
                          ></dd>
                        </dl>
                      </div>
                    </div>
                    <div class="mt-4">
                      <p
                        class="text-sm text-gray-600"
                        x-text="badge.description"
                      ></p>
                      <div class="flex items-center text-sm text-gray-500 mt-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Limit: <span x-text="badge.redBadgeLimit"></span> marta
                      </div>
                      <div class="flex items-center text-sm text-gray-500 mt-1">
                        <i class="fas fa-layer-group mr-2"></i>
                        Prioritet: <span x-text="badge.priority"></span>
                      </div>
                    </div>
                    <div class="mt-4 flex space-x-2">
                      <button
                        @click="editBadge(badge)"
                        class="flex-1 bg-primary-100 text-primary-700 px-3 py-2 rounded-md text-sm font-medium hover:bg-primary-200"
                      >
                        <i class="fas fa-edit mr-1"></i>
                        Tahrirlash
                      </button>
                      <button
                        @click="deleteBadge(badge)"
                        class="flex-1 bg-red-100 text-red-700 px-3 py-2 rounded-md text-sm font-medium hover:bg-red-200"
                      >
                        <i class="fas fa-trash mr-1"></i>
                        O'chirish
                      </button>
                    </div>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- Daily Badges Page -->
          <div x-show="currentPage === 'daily-badges'">
            <div class="mb-6 flex justify-between items-center">
              <div>
                <h2 class="text-2xl font-bold text-gray-900">
                  Kunlik Badge'lar
                </h2>
                <p class="text-gray-600">Kunlik badge'larni boshqarish</p>
              </div>
              <button
                @click="showAddDailyBadgeModal = true"
                class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium"
              >
                <i class="fas fa-plus mr-2"></i>
                Badge Berish
              </button>
            </div>

            <!-- Filters -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Guruh</label
                  >
                  <select
                    x-model="dailyBadgeFilters.group"
                    @change="loadDailyBadges()"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  >
                    <option value="">Barcha guruhlar</option>
                    <template x-for="group in groups" :key="group._id">
                      <option :value="group._id" x-text="group.name"></option>
                    </template>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                    >Sana</label
                  >
                  <input
                    x-model="dailyBadgeFilters.date"
                    @change="loadDailyBadges()"
                    type="date"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  />
                </div>
                <div class="flex items-end">
                  <button
                    @click="resetDailyBadgeFilters()"
                    class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm font-medium"
                  >
                    <i class="fas fa-undo mr-2"></i>
                    Tozalash
                  </button>
                </div>
              </div>
            </div>

            <!-- Daily Badges List -->
            <div class="space-y-4">
              <template x-for="dailyBadge in dailyBadges" :key="dailyBadge._id">
                <div class="bg-white shadow rounded-lg p-6">
                  <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                      <div
                        class="h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center"
                      >
                        <span
                          class="text-sm font-medium text-primary-700"
                          x-text="dailyBadge.student?.user?.fullName?.charAt(0)"
                        ></span>
                      </div>
                      <div class="ml-4">
                        <h3
                          class="text-lg font-medium text-gray-900"
                          x-text="dailyBadge.student?.user?.fullName"
                        ></h3>
                        <p class="text-sm text-gray-500">
                          Kod:
                          <span x-text="dailyBadge.student?.studentCode"></span>
                          | Sana:
                          <span
                            x-text="new Date(dailyBadge.date).toLocaleDateString('uz-UZ')"
                          ></span>
                        </p>
                      </div>
                    </div>
                    <div class="flex space-x-2">
                      <button
                        @click="editDailyBadge(dailyBadge)"
                        class="text-primary-600 hover:text-primary-900"
                      >
                        <i class="fas fa-edit"></i>
                      </button>
                      <button
                        @click="deleteDailyBadge(dailyBadge)"
                        class="text-red-600 hover:text-red-900"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <template
                      x-for="badgeEntry in dailyBadge.badges"
                      :key="badgeEntry._id"
                    >
                      <div class="flex items-center space-x-2">
                        <span
                          class="text-lg"
                          x-text="badgeEntry.badge?.emoji"
                        ></span>
                        <div class="flex-1">
                          <p
                            class="text-sm font-medium text-gray-900"
                            x-text="badgeEntry.badge?.name"
                          ></p>
                          <p
                            class="text-xs"
                            :class="{
                                                    'text-green-600': badgeEntry.status === 'earned',
                                                    'text-red-600': badgeEntry.status === 'not_earned',
                                                    'text-gray-600': badgeEntry.status === 'absent'
                                                   }"
                            x-text="badgeEntry.status === 'earned' ? 'Oldi' : badgeEntry.status === 'not_earned' ? 'Olmadi' : 'Yo\'q'"
                          ></p>
                        </div>
                      </div>
                    </template>
                  </div>
                  <div
                    x-show="dailyBadge.notes"
                    class="mt-4 p-3 bg-gray-50 rounded-md"
                  >
                    <p
                      class="text-sm text-gray-700"
                      x-text="dailyBadge.notes"
                    ></p>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- Payments Page -->
          <div x-show="currentPage === 'payments'">
            <div class="mb-6 flex justify-between items-center">
              <div>
                <h2 class="text-2xl font-bold text-gray-900">To'lovlar</h2>
                <p class="text-gray-600">To'lovlarni boshqarish</p>
              </div>
              <button
                @click="showAddPaymentModal = true"
                class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium"
              >
                <i class="fas fa-plus mr-2"></i>
                Yangi To'lov
              </button>
            </div>

            <!-- Payments Table -->
            <div class="bg-white shadow rounded-lg overflow-hidden">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      O'quvchi
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Summa
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Oy/Yil
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Holat
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Muddat
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Amallar
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <template x-for="payment in payments" :key="payment._id">
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div
                          class="text-sm font-medium text-gray-900"
                          x-text="payment.student?.user?.fullName"
                        ></div>
                        <div
                          class="text-sm text-gray-500"
                          x-text="payment.student?.studentCode"
                        ></div>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                      >
                        <span x-text="payment.amount?.toLocaleString()"></span>
                        so'm
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                      >
                        <span x-text="payment.month"></span>/<span
                          x-text="payment.year"
                        ></span>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                          :class="{
                                                    'bg-green-100 text-green-800': payment.status === 'paid',
                                                    'bg-yellow-100 text-yellow-800': payment.status === 'pending',
                                                    'bg-red-100 text-red-800': payment.status === 'overdue'
                                                  }"
                          x-text="payment.status === 'paid' ? 'To\'langan' : payment.status === 'pending' ? 'Kutilmoqda' : 'Muddati o\'tgan'"
                        >
                        </span>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                      >
                        <span
                          x-text="new Date(payment.dueDate).toLocaleDateString('uz-UZ')"
                        ></span>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm font-medium"
                      >
                        <button
                          @click="editPayment(payment)"
                          class="text-primary-600 hover:text-primary-900 mr-3"
                        >
                          <i class="fas fa-edit"></i>
                        </button>
                        <button
                          @click="deletePayment(payment)"
                          class="text-red-600 hover:text-red-900"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <!-- Add Student Modal -->
    <div
      x-show="showAddStudentModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
    >
      <div
        class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
      >
        <div class="mt-3">
          <h3 class="text-lg font-medium text-gray-900 mb-4">
            Yangi O'quvchi Qo'shish
          </h3>
          <form @submit.prevent="addStudent()">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >To'liq ism</label
                >
                <input
                  x-model="studentForm.fullName"
                  type="text"
                  required
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Telefon</label
                >
                <input
                  x-model="studentForm.phone"
                  type="tel"
                  placeholder="+998901234567"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Ota-ona telefoni</label
                >
                <input
                  x-model="studentForm.parentPhone"
                  type="tel"
                  placeholder="+998901234567"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Guruh</label
                >
                <select
                  x-model="studentForm.group"
                  required
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                >
                  <option value="">Guruhni tanlang</option>
                  <template x-for="group in groups" :key="group._id">
                    <option :value="group._id" x-text="group.name"></option>
                  </template>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Oylik to'lov</label
                >
                <input
                  x-model="studentForm.monthlyFee"
                  type="number"
                  required
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                />
              </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
              <button
                type="button"
                @click="showAddStudentModal = false"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"
              >
                Bekor qilish
              </button>
              <button
                type="submit"
                class="px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md"
              >
                Saqlash
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Daily Badge Modal -->
    <div
      x-show="showAddDailyBadgeModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
    >
      <div
        class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white"
      >
        <div class="mt-3">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Badge Berish</h3>
          <form @submit.prevent="addDailyBadge()">
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700"
                    >O'quvchi</label
                  >
                  <select
                    x-model="dailyBadgeForm.student"
                    required
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  >
                    <option value="">O'quvchini tanlang</option>
                    <template x-for="student in students" :key="student._id">
                      <option
                        :value="student._id"
                        x-text="student.user?.fullName + ' (' + student.studentCode + ')'"
                      ></option>
                    </template>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700"
                    >Sana</label
                  >
                  <input
                    x-model="dailyBadgeForm.date"
                    type="date"
                    required
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  />
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Badge'lar</label
                >
                <div class="space-y-3">
                  <template x-for="badge in badges" :key="badge._id">
                    <div
                      class="flex items-center justify-between p-3 border border-gray-200 rounded-md"
                    >
                      <div class="flex items-center">
                        <span class="text-lg mr-3" x-text="badge.emoji"></span>
                        <div>
                          <p
                            class="text-sm font-medium text-gray-900"
                            x-text="badge.name"
                          ></p>
                          <p
                            class="text-xs text-gray-500"
                            x-text="badge.description"
                          ></p>
                        </div>
                      </div>
                      <div class="flex space-x-2">
                        <label class="inline-flex items-center">
                          <input
                            type="radio"
                            :name="'badge_' + badge._id"
                            :value="'earned'"
                            @change="updateBadgeStatus(badge._id, 'earned')"
                            class="form-radio text-green-600"
                          />
                          <span class="ml-2 text-sm text-green-600">Oldi</span>
                        </label>
                        <label class="inline-flex items-center">
                          <input
                            type="radio"
                            :name="'badge_' + badge._id"
                            :value="'not_earned'"
                            @change="updateBadgeStatus(badge._id, 'not_earned')"
                            class="form-radio text-red-600"
                          />
                          <span class="ml-2 text-sm text-red-600">Olmadi</span>
                        </label>
                        <label class="inline-flex items-center">
                          <input
                            type="radio"
                            :name="'badge_' + badge._id"
                            :value="'absent'"
                            @change="updateBadgeStatus(badge._id, 'absent')"
                            class="form-radio text-gray-600"
                          />
                          <span class="ml-2 text-sm text-gray-600">Yo'q</span>
                        </label>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Izoh</label
                >
                <textarea
                  x-model="dailyBadgeForm.notes"
                  rows="3"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                ></textarea>
              </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
              <button
                type="button"
                @click="showAddDailyBadgeModal = false"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"
              >
                Bekor qilish
              </button>
              <button
                type="submit"
                class="px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md"
              >
                Saqlash
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="js/app.js"></script>
  </body>
</html>
